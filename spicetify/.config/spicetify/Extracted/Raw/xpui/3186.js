"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[3186],{23186:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ce});var n=a(67294),l=a(28216),r=a(51615),i=a(69518),c=a.n(i),s=a(48556),o=a(73305),m=a(96206),d=a(42038),u=a(95661),g=a(35410),y=a(20534),p=a(70369),E=a(55120),h=a(35213),f=a(23232),b=a(35796),I=a(99191),R=a(56802),v=a(30947),k=a(55911),x=a(20246),C=a(43620),P=a(84242),U=a(54444),T=a(42273),w=a(61048),A=a(94967),S=a(11680),B=a(45287);var F=a(48327),N=a(26991),_=a(42781);var D=a(34813),M=a(46895),L=a(1848),O=a(35308),z=a(28248),$=a(73785),X=a(4236),Z=a(42922),V=a(7073),K=a(49961),Q=a(24078),G=a(47307),H=a(2144),J=a(86213),W=a(21509),j=a(83384),q=a(82760),Y=a(32626),ee=a(85576),te=a(87257),ae=a(57978),ne=a(75016),le=a(26010),re=a(84788),ie=a(63962),ce=a(94184),se=a.n(ce),oe=a(83692);const me="TRDgmejiOzKjissuLFSx",de=({onClick:e=(()=>{}),className:t,label:a,ariaLabel:l=a,Icon:r})=>n.createElement(oe.w,{label:a},n.createElement("button",{type:"button","aria-label":l,className:se()(me,t),onClick:e},n.createElement(r,{iconSize:16}))),ue=n.memo((function({uri:e,uid:t,name:a,durationMs:l,artists:r,album:i,isMOGEFRestricted:s,isExplicit:o,isPlayable:d,index:u,playIndex:g=null,imgUrl:y,contextUri:p,usePlayContextItem:E,isEnhanced:h,playContextPageIndex:f,isFirstRecommendation:b,add:I,remove:R,canBeRemovedFromPlaylist:v,addedBy:k,addedAt:x}){const{useCurrentAvailability:C}=(0,n.useContext)(le.I),[P,T]=C(e),w=d&&P,{badges:A,hasBadges:S}=(0,re.r)({offlineAvailability:T,isExplicit:o,isMOGEFRestricted:s,isEnhanced:h}),B=u+1,F=r.items.map((e=>({uri:e.uri,name:e.profile.name}))),N=n.createElement(J.$,{uri:e,uid:t,albumUri:i?.uri,artists:F,contextUri:p,isRecommendation:h,removePlaylistItems:()=>R([t]),removeRecommendation:()=>R([t]),addRecommendation:()=>I(t),canBeRemovedFromPlaylist:v}),_=F?.map((e=>e.name)).join(m.ag.getSeparator())||"",{isActive:D,isPlaying:M,triggerPlay:O,togglePlay:z}=E({uid:t,uri:e,index:g??u,pageIndex:f}),{spec:$,logger:X}=(0,U.fU)(L.createDesktopTrackListRowEventFactory,{data:{position:u,reason:"",uri:e}}),V=n.createElement(de,{onClick:()=>{I(t),X.logInteraction($.addRecommendationButtonFactory().hitAddToPlaylist({playlist:p,itemToBeAdded:e}))},label:m.ag.get("web-player.enhance.button_label_keep_in_playlist"),Icon:Q.G});return n.createElement(Z.ZP,{value:"row",index:u},n.createElement(Y._P,{menu:N},n.createElement(q.c,{uri:e,contextUri:p,index:u,onTriggerPlay:()=>{O()},isActive:D,ariaRowIndex:u+1,isPlayable:w,ageRestricted:s,dragMetadata:{name:a,createdBy:_},spec:$,removePlaylistItems:e=>R(e.map((e=>e.id)))},n.createElement(W.Dd,{ariaColIndex:0},n.createElement(W.Du,{uri:e,playAriaLabel:m.ag.get("tracklist.a11y.play",a,_),onClick:(e,t)=>{z({loggingParams:t})},isPlaying:M,isActive:D,spec:$},n.createElement(W.km,null,B))),n.createElement(W.vZ,{ariaColIndex:1},n.createElement(W.lD,{src:y}),n.createElement(W.vm,null,n.createElement(W.Wh,{titleText:a},a),S&&n.createElement(W.g3,null,A.enhanced&&n.createElement(G._,{iconSize:16,className:j.Z.enhanced,title:m.ag.get("web-player.enhance.button_text_enhanced"),"aria-label":m.ag.get("web-player.enhance.button_text_enhanced")}),A.download&&n.createElement(ee.G,{size:16}),A.explicit&&n.createElement(te.N,null),A.paid&&n.createElement(ne.g,null),A.nineteen&&n.createElement(ae.X,{className:j.Z.nineteen,size:16})),n.createElement(W.K9,null,n.createElement(W.T6,{artists:F,spec:$})))),n.createElement(W.UA,{ariaColIndex:2},n.createElement(W.BM,{uri:i.uri,name:i.name,creatorUri:F?.[0]?.uri,spec:$},i.name)),n.createElement(W.UA,{ariaColIndex:3},n.createElement(W.p_,{name:k?.name||k?.id||"",uri:k?.id&&c().profileURI(k.id).toURI()||"",imageUrl:k?.avatar?.sources&&(0,K.X)(k?.avatar?.sources,{desiredWidth:24,desiredLabel:"small"})?.url||"",showAvatar:!0})),n.createElement(W.UA,{ariaColIndex:4},x?n.createElement(W.Op,{dateAdded:x}):null),n.createElement(W.mU,{ariaColIndex:5},h?n.createElement(n.Fragment,null,b?n.createElement(ie.T,{id:"enhance-add-recommendation",bodyText:m.ag.get("web-player.enhance.onboarding.add-recommendation-to-playlist"),shouldScrollIntoView:!0},V):V,n.createElement(de,{onClick:()=>{R([t]),X.logInteraction($.removeRecommendationButtonFactory().hitRemoveRecommendation({recommendedItemUri:e,contextUri:p}))},label:m.ag.get("web-player.enhance.button_label_remove_from_playlist"),Icon:H.H})):n.createElement(W.qS,{uri:e,type:"track",spec:$}),n.createElement(W.A$,{duration:l}),n.createElement(W.Zv,{menu:N,label:m.ag.get("more.label.track",a,_),spec:$})))))})),ge=[$.Q.INDEX,$.Q.TITLE,$.Q.ALBUM,$.Q.ADDED_BY,$.Q.ADDED_AT,$.Q.DURATION],ye=n.memo((function({ariaLabel:e,uri:t,name:a,usePlayContextItem:l,tracklistRef:r,fetchTracks:i,addRecommendation:c,removeItems:s,nrTracks:o,canBeRemovedFromPlaylist:d}){const u=(0,n.useRef)(!1),g=(0,X.k)();(0,n.useEffect)((()=>{u.current&&g&&r?.current?.update(),u.current=!0}),[g,r]);const y=50,p=(0,n.useRef)((()=>{})),[E,h]=(0,n.useState)([]),{logger:f,spec:b,UBIFragment:I}=(0,U.fU)(M.createDesktopTrackListEventFactory,{data:{uri:t,identifier:"enhanced-tracklist"}}),R=(0,n.useCallback)((()=>{if(r&&r.current){const{firstIndex:e,lastIndex:t}=r.current.getVisibleTrackWindow(),a=t-e;return Math.max(0,e-Math.round((y-a)/2))}return 0}),[r]),v=(0,n.useCallback)((e=>{p.current(),s({itemIds:e.map((({id:e})=>e)),offset:R(),limit:y});const a=new Set(e.map((({id:e})=>e))),n=r?.current?.getRows()||{},l=[];for(const e in n)if(a.has(n[e].uid)){const t={index:Number(e),item:n[e]};n[e].isEnhanced&&l.push(t)}if(l.length){let e;e=1===l.length?(0,L.createDesktopTrackListRowEventFactory)({data:{uri:l[0].item.uri,position:l[0].index,reason:""}}).removeRecommendationButtonFactory().hitRemoveRecommendation({contextUri:t,recommendedItemUri:l[0].item.uri}):b.removeItemsButtonFactory().hitRemoveRecommendations({contextUri:t,numberOfRecommendationsToRemove:l.length}),e&&f.logInteraction(e)}}),[s,R,f,r,t,b]),k=(0,n.useCallback)(((e,t)=>{p.current=t,e.length>1?h(e):v(e)}),[v]),x=(0,n.useCallback)((e=>{c({itemIds:[e],offset:R(),limit:y})}),[c,R]),C=(0,n.useCallback)((e=>{s({itemIds:e,offset:R(),limit:y})}),[s,R]),P=(0,n.useCallback)((function(e,a){const r=(0,K.X)(e.album.coverArt?.sources,{desiredSize:40,desiredLabel:"small"});return n.createElement(ue,{key:e.uid,index:a,playIndex:a,contextUri:t,uri:e.uri,uid:e.uid,isPlayable:e.playability.playable,durationMs:e.duration.totalMilliseconds,name:e.name,artists:e.artists,album:e.album,isExplicit:e.contentRating?.label===V.KS.Explicit,isMOGEFRestricted:e.contentRating?.label===V.KS.NineteenPlus,imgUrl:r?.url||"",usePlayContextItem:l,isEnhanced:e.isEnhanced,playContextPageIndex:e.playContextPageIndex,isFirstRecommendation:e.isFirstRecommendationOfPage&&a<y,add:x,remove:C,canBeRemovedFromPlaylist:d,addedBy:e.addedBy,addedAt:e.addedAt})}),[l,t,x,C,d]),T=(0,n.useCallback)((e=>e.uri),[]),w=(0,n.useCallback)((e=>e.uid),[]);return n.createElement(I,{spec:b},n.createElement(Z.ZP,{value:"playlist-tracklist"},n.createElement(z.Pv,{testID:"playlist-tracklist",key:t,ariaLabel:e,hasHeaderRow:!0,columns:ge,onRemove:k,renderRow:P,resolveUri:T,resolveUid:w,nrTracks:o,fetchTracks:i,limit:y,outerRef:r})),n.createElement(O.h,{title:m.ag.get("playlist.remove_from_playlist",a),isOpen:E.length>0,tracks:E,onClose:e=>{e.stopPropagation(),h([])},onRemove:v}))}));var pe=a(91281),Ee=a(55914),he=a(21770),fe=a(39838),be=a(99450),Ie=a(20452);const Re="z9JdxJgW3OxYysR2dkal";const ve=function({contextUri:e,title:t,message:a,children:l}){const r=(0,n.useRef)(null),[i,c]=(0,n.useState)(!1),s=(0,n.useCallback)((()=>{c(!1),r.current?.focus()}),[]),o=(0,n.useCallback)((()=>{c(!0)}),[]),{setIsEnhanced:d}=(0,B.U)(e);return n.createElement(pe.x,{onShow:o,onHide:s,placement:"topStart",overlay:i&&n.createElement(Ie.i,null,n.createElement("div",null,n.createElement(Ee.J,{role:"alertdialog",popoverTitle:t,arrow:"bottomEnd",colorSet:"announcement"},a,n.createElement("div",{className:Re},n.createElement(he.oM,{buttonSize:fe.z.sm,onClick:s},m.ag.get("web-player.enhance.missing-functionality-callout.dismiss")),n.createElement(be.D,{buttonSize:fe.z.sm,onClick:()=>{s(),d(!1)},colorSet:"invertedLight"},m.ag.get("web-player.enhance.missing-functionality-callout.turn-off-enhance"))))))},function(e){return"function"==typeof e}(l)?n.createElement(n.Fragment,null,l(o)):l)},ke="A4dupilHPIEDfhXDE0m0",xe="JYAfUd8XXrVwcPbq9QaC",Ce=n.memo((function({metadata:e,capabilities:t,featureIdentifier:a}){const{uri:i,name:M,images:L,totalLength:O}=e,[z]=L,$=(0,C.Z)(z?.url||null),X=(0,r.k6)(),Z=(0,l.I0)(),V=(0,R.o)(),K=(0,n.useRef)(null),Q=c().isPlaylistV1OrV2(i),{isEnhanced:G,playContext:H,numTotalItems:J,numTotalRecs:W,addRecommendation:j,removeItems:q,fetchTracks:Y,enhancedRevision:ee,shouldUnderlyingContextChangeRefreshView:te,UBIReason:ae,clearCache:ne,fetchIndexOfItemId:le}=function(e){const t=(0,S._)(),{isEnhanced:a,iteration:l,setIsEnhanced:r,toggleIsEnhanced:i}=(0,B.U)(e),[c,s]=(0,n.useState)(null),o=(0,n.useRef)(Date.now()),m=(0,n.useCallback)((()=>Date.now()-o.current>3e3),[]),d=(0,n.useRef)({}),u=(0,n.useRef)(null),g=(0,n.useCallback)((async(e,a,n,l,r,i,c)=>{i&&(o.current=Date.now());const m=u.current?.enhancedRevision;let g;try{g=await c}catch(i){409===i?.status&&(g=await t.getPage(e,a,n,l,r))}const y=g?.enhancePage;if(!y)return[];const{pageItems:p,...E}=y,h=await t.decoratePageItems(p);return m!==u.current?.enhancedRevision?[]:(u.current?.enhancedRevision!==E.enhancedRevision&&(i=!0),d.current=function(e,t,a,n){const l=n?{}:{...e};return t.forEach(((e,t)=>{l[a+t]=e})),l}(d.current,h,l,i),s(E),u.current=E,h)}),[t]),y=(0,n.useCallback)((async({itemIds:a,offset:n=0,limit:r=1})=>{u.current&&l&&g(e,l,u.current.sessionId,n,r,!0,t.addRecommendation(e,u.current.sessionId,a,n,r))}),[g,e,t,l]),p=(0,n.useCallback)((async({itemIds:a,offset:n=0,limit:r=1})=>{if(!u.current||!l)return;const i=d.current,c=new Set(a);let s=!1;for(const e in i)if(c.has(i[e].uid)&&i[e].isEnhanced){s=!0;break}g(e,l,u.current.sessionId,n,r,!0,t.removeItems(e,u.current.sessionId,a,n,r,s))}),[g,e,t,l]),E=(0,n.useMemo)((()=>new A.tL),[]),h=(0,n.useCallback)((async(a,n)=>{if(!l)return[];const r=Math.min(n,(u.current?.numTotalItems||1/0)-a),i=Array.from({length:r},((e,t)=>d.current[t+a]));return i.every((e=>!!e))&&0!==r?i:g(e,l,u.current?.sessionId,a,n,!1,E.create(`${e}:${l}:${u.current?.sessionId}:${a}:${n}`,(()=>t.getPage(e,l,u.current?.sessionId,a,n))))}),[E,g,e,t,l]),f=(0,n.useMemo)((()=>({uri:e,url:c?.dspContextUri})),[e,c?.dspContextUri]),b=(0,n.useCallback)((()=>{d.current={}}),[]),I=(0,n.useCallback)((async a=>{if(!l)return-1;const{enhancePage:n}=await t.getPage(e,l,u.current?.sessionId,0,t.MAX_PAGE_SIZE);return n?.pageItems.findIndex((e=>e.itemId===a))??-1}),[t,l,e]);return{isEnhanced:a,setIsEnhanced:r,toggleIsEnhanced:i,addRecommendation:y,removeItems:p,playContext:f,numTotalItems:isNaN(Number(c?.numTotalItems))?void 0:Number(c?.numTotalItems),numTotalRecs:isNaN(Number(c?.numTotalRecs))?void 0:Number(c?.numTotalRecs),fetchTracks:h,clearCache:b,enhancedRevision:c?.enhancedRevision,shouldUnderlyingContextChangeRefreshView:m,UBIReason:c?`enhanced|${c?.sessionId}#${c?.logging?.correlationId}`:"enhanced|",fetchIndexOfItemId:I}}(i),re=ee?!!J:!!O,ie=t?.canFilter&&O>0,ce=t?.canSort&&O>0;(0,n.useEffect)((()=>{if(G&&"POP"!==X.action){const e=new URLSearchParams(X.location.search).get("uid");if(!e)return;le(e).then((e=>{-1!==e&&K.current?.scrollToIndex(e)}))}}),[X,X.action,X.location.search,le,G]),(0,n.useEffect)((()=>{ee&&K.current?.update()}),[ee]),(0,n.useEffect)((()=>{te()&&(ne(),K.current?.update())}),[O,ne,te]);const{spec:se,logger:oe,UBIFragment:me}=(0,U.fU)(s.createDesktopEnhancedEventFactory,{data:{uri:i,identifier:"enhanced-session",reason:ae}}),de=(0,n.useMemo)((()=>({header:se.headerFactory()})),[se]),{isPlaying:ue,isActive:ge,togglePlay:pe,usePlayContextItem:Ee}=(0,P.n)(H,{featureIdentifier:a}),he=(0,n.useCallback)((()=>{let e;pe(),e=ge?ue?se.playButtonFactory().hitPause({itemToBePaused:i}):se.playButtonFactory().hitResume({itemToBeResumed:i}):se.playButtonFactory().hitPlay({itemToBePlayed:i}),oe.logInteraction(e)}),[pe,ue,ge,oe,se,i]),fe=function(e=0){const{data:t}=(0,F.J)(N.n5.getUser,["spotify"]);return(0,n.useMemo)((()=>t?.body?{isOwner:!1,tracksAdded:e,user:{uri:t.body.uri,type:_.p.USER,username:t.body.id,displayName:t.body.display_name,images:t.body.images}}:null),[t,e])}(W),be=e.collaborators?.items?.concat()??[];fe&&be.splice(T.ms-1,0,fe);const Ie={count:be.length,items:be},Re=(0,n.useCallback)(((e,t)=>{const a=[...t[I.aN[c().Type.ALBUM]]||[],...t[I.aN[c().Type.TRACK]]||[]];a.length>0&&(Z((0,d.jV)(i,a)),V({targetUri:i,intent:"add",type:"drop"}))}),[Z,V,i]);return n.createElement(n.Suspense,{fallback:null},n.createElement(b.N,{path:"/playlist/:playlistId",pageId:o.W.ENHANCED_SESSION}),n.createElement(me,{spec:se},n.createElement(p.$,null,m.ag.get("playlist.page-title",M)),n.createElement(y.Z,{types:[I.aN[c().Type.ALBUM],I.aN[c().Type.TRACK]],onDrop:Re},n.createElement("section",{role:"presentation",className:ke,"data-testid":"enhanced-page"},n.createElement(me,{spec:de.header},n.createElement(f.s,{metadata:{...e,collaborators:Ie,duration:void 0,totalLength:J??O},isPlaying:ue,togglePlay:he,backgroundColor:$}),n.createElement("div",null,n.createElement(v.o,{backgroundColor:$},n.createElement(v.F,null,re?n.createElement(E.$,{onClick:he,isPlaying:ue,size:k.qE.lg,uri:i}):null,n.createElement(D.v,{uri:i}),Q&&n.createElement(x.y,{menu:n.createElement(g.X,{uri:i,isEnhanced:G})},n.createElement(u.z,null)),(ie||ce)&&n.createElement("div",{className:xe},ie&&n.createElement(n.Suspense,{fallback:null},n.createElement(ve,{contextUri:i,title:m.ag.get("web-player.enhance.missing-functionality-callout.filtering-playlist-disabled-title"),message:m.ag.get("web-player.enhance.missing-functionality-callout.filtering-playlist-disabled-message")},(e=>n.createElement(w.K,{placeholder:m.ag.get("playlist.search_in_playlist"),onActivate:()=>(e(),!1)})))),ce&&n.createElement(ve,{contextUri:i,title:m.ag.get("web-player.enhance.missing-functionality-callout.sorting-playlist-disabled-title"),message:m.ag.get("web-player.enhance.missing-functionality-callout.sorting-playlist-disabled-message")},n.createElement(h.l,{columns:[],disabled:!0}))))))),n.createElement("div",{className:"contentSpacing"},n.createElement(n.Suspense,{fallback:null},n.createElement(ye,{key:i,ariaLabel:M,nrTracks:J??Math.max(15,O),uri:i,name:M,usePlayContextItem:Ee,tracklistRef:K,fetchTracks:Y,addRecommendation:j,removeItems:q,canBeRemovedFromPlaylist:Q})))))))}))}}]);
//# sourceMappingURL=3186.js.map